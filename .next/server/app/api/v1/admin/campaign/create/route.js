"use strict";(()=>{var e={};e.id=7515,e.ids=[7515],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},80823:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var r={};t.r(r),t.d(r,{POST:()=>l});var a=t(49303),n=t(88716),i=t(60670),o=t(87070),u=t(75748),c=t(5732),p=t(41482),d=t.n(p);let m=["http://localhost:3000","https://connectafrica-fawn.vercel.app"];async function l(e){try{let s=e.headers.get("origin");if(s&&!m.includes(s))return o.NextResponse.json({success:!1,message:"CORS policy: Origin not allowed"},{status:403});let t=e.headers.get("authorization"),r=t?.split(" ")[1];if(!r)return o.NextResponse.json({success:!1,message:"Unauthorized"},{status:401});try{d().verify(r,process.env.JWT_SECRET)}catch{return o.NextResponse.json({success:!1,message:"Invalid or expired token"},{status:401})}let{title:a,description:n,amount:i,startDate:p,endDate:l,imageBase64:g,category:v}=await e.json();if(!a)return o.NextResponse.json({success:!1,message:"Title is required"},{status:400});if(!n)return o.NextResponse.json({success:!1,message:"Description is required"},{status:400});if(!i)return o.NextResponse.json({success:!1,message:"Amount is required"},{status:400});if(!v||!["Education","Community","Elderly","Empowerment","Children","Healthcare","Infrastructure","Events","Others","Food","Emergency"].includes(v.trim()))return o.NextResponse.json({success:!1,message:"Invalid category"},{status:400});if(!p)return o.NextResponse.json({success:!1,message:"Start date is required"},{status:400});if(!l)return o.NextResponse.json({success:!1,message:"End date is required"},{status:400});if(!g)return o.NextResponse.json({success:!1,message:"Image is required"},{status:400});let x=await c.Z.uploader.upload(g,{folder:"campaigns",resource_type:"image"}),f=(await u.Z).db("connect_africa").collection("campaigns");"Emergency"===v&&await f.updateMany({category:"Emergency",status:"inprogress"},{$set:{status:"inactive"}});let h={title:a,description:n,category:v,priority:"Emergency"===v,status:"inprogress",amount:Number(i),donatedAmount:0,startDate:new Date(p),endDate:new Date(l),imageUrl:x.secure_url,volunteers:0,createdAt:new Date,updatedAt:new Date},R=await f.insertOne(h),q=await f.findOne({_id:R.insertedId});return o.NextResponse.json({success:!0,message:"Campaign created!",campaign:q})}catch(e){return console.error("Campaign creation error:",e),o.NextResponse.json({success:!1,message:e.message||"Internal Server Error"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/v1/admin/campaign/create/route",pathname:"/api/v1/admin/campaign/create",filename:"route",bundlePath:"app/api/v1/admin/campaign/create/route"},resolvedPagePath:"C:\\Users\\HP\\OneDrive\\Desktop\\project2\\connect africa\\src\\app\\api\\v1\\admin\\campaign\\create\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:f}=g,h="/api/v1/admin/campaign/create/route";function R(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},5732:(e,s,t)=>{t.d(s,{Z:()=>a});var r=t(49788);r.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let a=r.v2},75748:(e,s,t)=>{t.d(s,{Z:()=>n});var r=t(38013);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define MONGODB_URI in .env");let n=new r.MongoClient(a).connect()}};var s=require("../../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[9276,5972,1482,9788],()=>t(80823));module.exports=r})();