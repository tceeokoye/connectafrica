"use strict";(()=>{var e={};e.id=6661,e.ids=[6661],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},58112:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>R,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var r={};t.r(r),t.d(r,{POST:()=>m});var a=t(49303),o=t(88716),n=t(60670),i=t(87070),u=t(75748),c=t(5732),p=t(41482),l=t.n(p);let d=["News","Events","Updates","Projects","Team","Impact","Stories"],g=["http://localhost:3000","https://cohaaf2.vercel.app"];async function m(e){try{let s=e.headers.get("origin");if(s&&!g.includes(s))return i.NextResponse.json({success:!1,message:"CORS policy: Origin not allowed"},{status:403});let t=e.headers.get("authorization"),r=t?.split(" ")[1];if(!r)return i.NextResponse.json({success:!1,message:"Unauthorized"},{status:401});try{l().verify(r,process.env.JWT_SECRET)}catch{return i.NextResponse.json({success:!1,message:"Invalid or expired token"},{status:401})}let{title:a,excerpt:o,content:n,author:p,readTime:m,category:x,imageBase64:f,tags:v,featured:h}=await e.json();if(!a)return i.NextResponse.json({success:!1,message:"Title is required"},{status:400});if(a.length>100)return i.NextResponse.json({success:!1,message:"Title must be 100 characters or fewer"},{status:400});if(!o)return i.NextResponse.json({success:!1,message:"Excerpt is required"},{status:400});if(o.length>300)return i.NextResponse.json({success:!1,message:"Excerpt must be 300 characters or fewer"},{status:400});if(!n)return i.NextResponse.json({success:!1,message:"Content is required"},{status:400});if(!f)return i.NextResponse.json({success:!1,message:"Image is required"},{status:400});if(!x||!d.includes(x))return i.NextResponse.json({success:!1,message:`Invalid category. Allowed: ${d.join(", ")}`},{status:400});if(v&&(!Array.isArray(v)||!v.every(e=>"string"==typeof e)))return i.NextResponse.json({success:!1,message:"Tags must be an array of strings"},{status:400});let R=await c.Z.uploader.upload(f,{folder:"blogs",resource_type:"image"}),j=(await u.Z).db("connect_africa").collection("blogs"),w=a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");if(await j.findOne({slug:w}))return i.NextResponse.json({success:!1,message:"Blog with same title already exists"},{status:409});h&&await j.updateMany({featured:!0},{$set:{featured:!1}});let N={slug:w,title:a,excerpt:o,content:n,image:R.secure_url,author:p||"Admin",readTime:m||"3 min read",category:x,tags:v||[],featured:!!h,date:new Date().toDateString(),createdAt:new Date,updatedAt:new Date},q=await j.insertOne(N),y=await j.findOne({_id:q.insertedId});return i.NextResponse.json({success:!0,message:"Blog created successfully",blog:y})}catch(e){return console.error("Blog creation error:",e),i.NextResponse.json({success:!1,message:"Internal Server Error"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/v1/admin/blog/create/route",pathname:"/api/v1/admin/blog/create",filename:"route",bundlePath:"app/api/v1/admin/blog/create/route"},resolvedPagePath:"C:\\Users\\HP\\OneDrive\\Desktop\\project2\\connect africa\\src\\app\\api\\v1\\admin\\blog\\create\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:h}=x,R="/api/v1/admin/blog/create/route";function j(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},5732:(e,s,t)=>{t.d(s,{Z:()=>a});var r=t(49788);r.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let a=r.v2},75748:(e,s,t)=>{t.d(s,{Z:()=>o});var r=t(38013);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define MONGODB_URI in .env");let o=new r.MongoClient(a).connect()}};var s=require("../../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[9276,5972,1482,9788],()=>t(58112));module.exports=r})();