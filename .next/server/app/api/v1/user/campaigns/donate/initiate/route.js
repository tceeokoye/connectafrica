"use strict";(()=>{var e={};e.id=8990,e.ids=[8990],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},26544:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>N});var n={};s.r(n),s.d(n,{POST:()=>l});var a=s(49303),r=s(88716),o=s(60670),i=s(87070),c=s(75748),u=s(84770),p=s.n(u);let d=["http://localhost:3000","https://cohaaf2.vercel.app"];async function l(e){try{let t=e.headers.get("origin");if(t&&!d.includes(t))return i.NextResponse.json({success:!1,message:"CORS policy: Origin not allowed"},{status:403});let{campaignId:n,firstName:a,lastName:r,email:o,phone:u,amount:l}=await e.json();if(!n||!a||!r||!o||!u||!l)return i.NextResponse.json({success:!1,message:"All fields are required"},{status:400});let m=(await c.Z).db("connect_africa"),g=m.collection("campaigns"),N=await g.findOne({_id:new(s(38013)).ObjectId(n)});if(!N)return i.NextResponse.json({success:!1,message:"Campaign not found"},{status:404});let f=`DON_${Date.now()}_${p().randomUUID()}`,h=Buffer.from(`${process.env.MONNIFY_API_KEY}:${process.env.MONNIFY_SECRET_KEY}`).toString("base64"),v=await fetch(`${process.env.MONNIFY_BASE_URL}/api/v1/merchant/transactions/init-transaction`,{method:"POST",headers:{Authorization:`Basic ${h}`,"Content-Type":"application/json"},body:JSON.stringify({amount:Number(l),customerName:`${a} ${r}`,customerEmail:o,paymentReference:f,paymentDescription:`Donation for ${N.title}`,currencyCode:"NGN",contractCode:process.env.MONNIFY_CONTRACT_CODE,redirectUrl:"http://localhost:3000/donate/success",paymentMethods:["CARD","ACCOUNT_TRANSFER"],metadata:{campaignId:n,donorName:`${a} ${r}`,phone:u}})}),O=await v.json();if(!O.requestSuccessful)return i.NextResponse.json({success:!1,message:O.responseMessage},{status:400});let R=m.collection("donations");return await R.insertOne({campaignId:n,reference:f,firstName:a,lastName:r,email:o,phone:u,amount:Number(l),status:"pending",createdAt:new Date}),i.NextResponse.json({success:!0,checkoutUrl:O.responseBody.checkoutUrl,reference:f})}catch(e){return console.error("Donate init error:",e),i.NextResponse.json({success:!1,message:"Payment initialization failed"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/v1/user/campaigns/donate/initiate/route",pathname:"/api/v1/user/campaigns/donate/initiate",filename:"route",bundlePath:"app/api/v1/user/campaigns/donate/initiate/route"},resolvedPagePath:"C:\\Users\\HP\\OneDrive\\Desktop\\project2\\connect africa\\src\\app\\api\\v1\\user\\campaigns\\donate\\initiate\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:N,serverHooks:f}=m,h="/api/v1/user/campaigns/donate/initiate/route";function v(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:N})}},75748:(e,t,s)=>{s.d(t,{Z:()=>r});var n=s(38013);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define MONGODB_URI in .env");let r=new n.MongoClient(a).connect()}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[9276,5972],()=>s(26544));module.exports=n})();